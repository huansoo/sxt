<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="company">
  <typeAlias alias="CompanyInfo" type="com.wugu.zhaopin.webapp.model.ZpCompanyInfoModel"/>   
  <typeAlias alias="CompanyContact" type="com.wugu.zhaopin.webapp.model.ZpCompanyContactModel"/>
  <typeAlias alias="CompanyInfoCriteria" type="com.wugu.zhaopin.webapp.model.ZpCompanyInfoCriteria"/>  
  <typeAlias alias="PostResultModel" type="com.wugu.zhaopin.webapp.model.PostResultModel"/>  
  <typeAlias alias="PostSearchCriteria" type="com.wugu.zhaopin.webapp.model.PostSearchCriteria"/> 
  <typeAlias alias="PostReport" type="com.wugu.zhaopin.webapp.model.PostReport"/>  
  <typeAlias alias="PostReportCriteria" type="com.wugu.zhaopin.webapp.model.PostReportCriteria"/>  
  <resultMap class="CompanyContact" id="CompanyContactResultMap">
    <result column="company_contact_id" jdbcType="INTEGER" property="companyContactId" />
    <result column="company_id" jdbcType="INTEGER" property="companyId" />
    <result column="location" jdbcType="VARCHAR" property="location" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="contact_man" jdbcType="VARCHAR" property="contactMan" />
    <result column="mobile_tel" jdbcType="VARCHAR" property="mobileTel" />
    <result column="fixed_tel" jdbcType="VARCHAR" property="fixedTel" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="create_time" jdbcType="INTEGER" property="createTime" />
    <result column="update_time" jdbcType="INTEGER" property="updateTime" />
    <result column="op_id" jdbcType="BIGINT" property="opId" />
  </resultMap>
  <resultMap class="CompanyInfo" id="ibatorgenerated_BaseResultMap">
    <result column="company_id" jdbcType="INTEGER" property="companyId" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="introduce" jdbcType="VARCHAR" property="introduce" />
    <result column="industry_id" jdbcType="VARCHAR" property="industryId" />
    <result column="company_type" jdbcType="INTEGER" property="companyType" />
    <result column="scale_id" jdbcType="INTEGER" property="scaleId" />
    <result column="license" jdbcType="VARCHAR" property="license" />
    <result column="site_url" jdbcType="VARCHAR" property="siteUrl" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="create_time" jdbcType="INTEGER" property="createTime" />
    <result column="update_time" jdbcType="INTEGER" property="updateTime" />
    <result column="op_id" jdbcType="BIGINT" property="opId" />
    <result column="new_delivery_count" jdbcType="BIGINT" property="newDeliveryCount" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="company_id" property="companyContact" select="company.companyContact_selectByPrimaryKey" />
  </resultMap>
  
  <select id="companyContact_selectByPrimaryKey" parameterClass="int" resultClass="CompanyContact" resultMap="CompanyContactResultMap">
    select company_contact_id, company_id, location, address, contact_man, mobile_tel, fixed_tel,
      email, type, status, create_time, update_time, op_id
    from zp_company_contact
    where company_id = #companyId:INTEGER# limit 0,1
  </select> 

  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Dec 18 15:16:05 CST 2013.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="CompanyInfoCriteria" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Dec 18 15:16:05 CST 2013.
    -->
    	   	SELECT
			company_id,
			user_id,
			NAME,
			introduce,
			industry_id,
			company_type,
			scale_id,
			license,
			site_url,
			type,
			STATUS,
			create_time,
			update_time,
			op_id,
			user_name,
			(
				SELECT
					count(*)
				FROM
					zp_delivery_info d
				WHERE
					d.company_id = c.company_id
				AND d.`status` = 1
			) new_delivery_count
		FROM
			zp_company_info c				

    <isParameterPresent>
      <include refid="zp_company_info.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="CompanyInfo" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Dec 18 15:16:05 CST 2013.
    -->
	   	SELECT
			company_id,
			NAME,
			user_id,
			introduce,
			industry_id,
			company_type,
			scale_id,
			license,
			site_url,
			type,
			STATUS,
			create_time,
			update_time,
			op_id,
			user_name,
			(
				SELECT
					count(*)
				FROM
					zp_delivery_info d
				WHERE
					d.company_id = c.company_id
				AND d.`status` = 1
			) new_delivery_count
		FROM
			zp_company_info c				

    where company_id = #companyId:INTEGER#
  </select>  
   <select id="ibatorgenerated_countByExample" parameterClass="CompanyInfoCriteria" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Dec 18 15:16:05 CST 2013.
    -->
    select count(*) from zp_company_info
    <include refid="zp_company_info.ibatorgenerated_Example_Where_Clause" />
  </select>
  
   <select id="selectByPage" resultMap="ibatorgenerated_BaseResultMap" parameterClass="CompanyInfo" >
	   	SELECT
			company_id,
			user_id,
			NAME,
			introduce,
			industry_id,
			company_type,
			scale_id,
			license,
			site_url,
			type,
			STATUS,
			create_time,
			update_time,
			op_id,
			user_name,
			(
				SELECT
					count(*)
				FROM
					zp_delivery_info d
				WHERE
					d.company_id = c.company_id
				AND d.`status` = 1
			) new_delivery_count
		FROM
			zp_company_info c				
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		      <isNotNull property="orderByClause" >
		        order by $orderByClause$
		      </isNotNull>
		</isParameterPresent>			
		<![CDATA[  limit $pageInfo.offset$]]>
		<![CDATA[    , $pageInfo.pageSize$]]>  
   </select>
   
  <resultMap class="PostResultModel" id="PostResult" >
    <result column="post_id" jdbcType="INTEGER" property="postId" />
    <result column="company_id" jdbcType="INTEGER" property="companyId" />
    <result column="name" jdbcType="VARCHAR" property="postName" />
    <result column="company_name" jdbcType="VARCHAR" property="companyName" />    
    <result column="educationbg" jdbcType="VARCHAR" property="educationBg" />
    <result column="recruit_num" jdbcType="INTEGER" property="recruitNum" />    
    <result column="work_address" jdbcType="VARCHAR" property="workAddress" />    
    <result column="update_time" jdbcType="INTEGER" property="updateTime" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="post_id" property="newDeliveryCount" select="company.getNewDeliveryCount"/>
   </resultMap>
   
   <select id="getNewDeliveryCount" resultClass="java.lang.Integer" parameterClass="java.lang.Integer">
   		SELECT
			count(*) new_delivery_count
		FROM
			zp_delivery_info d
		WHERE
			d.post_id = #post_id:INTEGER#
		AND d.`status` = 1
   </select>
   
   <select id="countByExample" resultClass="java.lang.Integer" parameterClass="PostSearchCriteria" >
   		SELECT
			COUNT(DISTINCT post_id)
		FROM
			(
				SELECT
					b.*, d1.dic_value AS educationbg
				FROM
					(
						SELECT
							p.company_id,
							c.`name` AS company_Name,
							c.company_type,
							t.location,
							p.post_id,
							p.post_type,
							p.salary,
							p.work_exprience,
							p.`name`,
							p.work_address,
							p.update_time,
							p.education_bg,
							p.recruit_num,
							p.`status`
						FROM
							zp_post_info p,
							zp_company_info c,
							zp_company_contact t
						WHERE
							p.company_id = c.company_id
						AND c.company_id = t.company_id
					) b
				LEFT JOIN zp_dictinary d1 ON d1.parent_id = 2
				AND d1.dic_id = b.education_bg
			) a		
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		</isParameterPresent>
   </select>  
    
   <select id="getPostResult" resultMap="PostResult" parameterClass="PostSearchCriteria" >
   		SELECT DISTINCT
			post_id post_id,
			company_id,
			company_name,
			NAME,
			educationbg,
			recruit_num,
			work_address,
			update_time,
			status
		FROM
			(
				SELECT
					b.*, d1.dic_value AS educationbg
				FROM
					(
						SELECT
							p.company_id,
							c.`name` AS company_Name,
							c.company_type,
							t.location,
							p.post_id,
							p.post_type,
							p.salary,
							p.work_exprience,
							p.`name`,
							p.work_address,
							p.update_time,
							p.education_bg,
							p.recruit_num,
							p.`status`
						FROM
							zp_post_info p,
							zp_company_info c,
							zp_company_contact t
						WHERE
							p.company_id = c.company_id
						AND c.company_id = t.company_id
					) b
				LEFT JOIN zp_dictinary d1 ON d1.parent_id = 2
				AND d1.dic_id = b.education_bg
			) a		
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		      <isNotNull property="orderByClause" >
		        order by $orderByClause$
		      </isNotNull>
		</isParameterPresent>			
		<![CDATA[  limit $pageInfo.offset$]]>
		<![CDATA[    , $pageInfo.pageSize$]]> 
   </select>
   <select id="getLastPostList" resultMap="PostResult" parameterClass="PostSearchCriteria" >
   		SELECT DISTINCT
			post_id post_id,
			company_id,
			company_name,
			NAME,
			educationbg,
			recruit_num,
			work_address,
			update_time,
			status
		FROM
			(
				SELECT
					b.*, d1.dic_value AS educationbg
				FROM
					(
						SELECT
							p.company_id,
							c.`name` AS company_Name,
							c.company_type,
							t.location,
							p.post_id,
							p.post_type,
							p.salary,
							p.work_exprience,
							p.`name`,
							p.work_address,
							max(p.update_time) update_time,
							p.education_bg,
							p.recruit_num,
							p.`status`
						FROM
							zp_post_info p,
							zp_company_info c,
							zp_company_contact t
						WHERE
							p.company_id = c.company_id
						AND c.company_id = t.company_id
            group by p.company_id
						order by update_time DESC
					) b
				LEFT JOIN zp_dictinary d1 ON d1.parent_id = 2
				AND d1.dic_id = b.education_bg
			) a			
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		      <isNotNull property="orderByClause" >
		        order by $orderByClause$
		      </isNotNull>
		</isParameterPresent>			
		<![CDATA[  limit $pageInfo.offset$]]>
		<![CDATA[    , $pageInfo.pageSize$]]> 
   </select>
   
   <resultMap id="PostReportMap" class="PostReport" >    
    <result column="company_id" property="companyId" jdbcType="INTEGER" />
    <result column="company_Name" property="companyName" jdbcType="VARCHAR" />
    <result column="post_id" property="postId" jdbcType="BIGINT" />
    <result column="post_name" property="postName" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="INTEGER" />
    <result column="update_time" property="updateTime" jdbcType="INTEGER" />
    <result column="post_status" property="postStatus" jdbcType="INTEGER" />
    <result column="company_time" property="companyTime" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="company_status" property="companyStatus" jdbcType="INTEGER" />
    <result column="work_address" property="workAddress" jdbcType="VARCHAR" />
  </resultMap>
  
   <select id="getPostReport" resultMap="PostReportMap" parameterClass="PostReportCriteria">
		SELECT
			company_id,
			company_name,
			post_id,
			post_name,
			create_time,
			update_time,
			post_status,
			company_time,
			user_name,
			company_status,
			work_address
		FROM
			(
				SELECT
					p.company_id,
					c.`name` AS company_name,
					p.post_id,
					p.`name` post_name,
					p.create_time,
					p.update_time,
					p.`status` post_status,
					c.create_time company_time,
					u.user_name user_name,
					c.`status` company_status,
					p.work_address
				FROM
					zp_post_info p,
					zp_company_info c,
					zp_user u
				WHERE
					p.company_id = c.company_id
				AND c.user_id = u.user_id
			) a
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		      <isNotNull property="orderByClause" >
		        order by $orderByClause$
		      </isNotNull>
		</isParameterPresent>			
		<![CDATA[  limit $pageInfo.offset$]]>
		<![CDATA[    , $pageInfo.pageSize$]]> 
   </select>
   <select id="countPostReport" resultClass="java.lang.Integer" parameterClass="PostReportCriteria" >
   		SELECT
			count(*)
		FROM
		(
			SELECT
				p.company_id,
				c.`name` AS company_Name,
				p.post_id,
				p.`name` post_name,
				p.create_time,
				p.update_time,
				p.`status` post_status,
				c.create_time company_time,
				u.user_name user_name,
				c.`status` company_status,
				p.work_address
			FROM
				zp_post_info p,
				zp_company_info c,
				zp_user u
			WHERE
				p.company_id = c.company_id
			AND c.user_id = u.user_id
		) a	
		<isParameterPresent >
		      <include refid="company.ibatorgenerated_Example_Where_Clause" />
		</isParameterPresent>
   </select> 

</sqlMap>